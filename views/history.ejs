<div class="max-w-7xl mx-auto px-4 py-6">
  <div class="bg-white shadow rounded-lg p-6">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold text-gray-900">교정 이력</h1>
      <div class="flex space-x-2">
        <button
          id="all-btn"
          class="px-4 py-2 bg-blue-600 text-white rounded-md"
        >
          전체
        </button>
        <button
          id="spelling-btn"
          class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md"
        >
          맞춤법
        </button>
        <button
          id="pronunciation-btn"
          class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md"
        >
          발음
        </button>
      </div>
    </div>

    <div id="history-list" class="space-y-6">
      <% if (!scripts.length && !voice.length) { %>
      <div class="flex flex-col items-center justify-center py-12">
        <div class="text-gray-400 mb-4">
          <i class="fas fa-history fa-3x"></i>
        </div>
        <p class="text-gray-500 text-lg">아직 교정 이력이 없습니다.</p>
        <p class="text-gray-400 mt-2">
          맞춤법 검사나 발음 교정을 시작해보세요!
        </p>
      </div>
      <% } else { %>
      <!-- 맞춤법 검사 결과 -->
      <% scripts.forEach(function(script) { %>
      <div
        class="border rounded-lg p-4 hover:bg-gray-50"
        data-id="<%= script.id %>"
      >
        <div class="flex justify-between items-start mb-2">
          <div>
            <span
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
              >맞춤법</span
            >
            <span class="text-sm text-gray-500 ml-2"
              ><%= new Date(script.time).toLocaleString() %></span
            >
          </div>
        </div>
        <div class="font-medium mb-2"><%= script.title %></div>
        <div class="text-sm text-gray-600 mb-2">원문: <%= script.text %></div>
        <div class="text-sm text-blue-600">
          교정: <%= script.aiScript.text || '분석 중...' %>
        </div>
      </div>
      <% }); %>

      <!-- 발음 교정 결과 -->
      <% voice.forEach(function(voiceItem) { %>
      <div
        class="border rounded-lg p-4 hover:bg-gray-50"
        data-id="<%= voiceItem.id %>"
      >
        <div class="flex justify-between items-start mb-2">
          <div>
            <span
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"
              >발음</span
            >
            <span class="text-sm text-gray-500 ml-2"
              ><%= new Date(voiceItem.time).toLocaleString() %></span
            >
          </div>
        </div>
        <div class="mb-4">
          <audio controls class="w-full">
            <source src="<%= voiceItem.url %>" type="audio/mp3" />
          </audio>
        </div>
        <div class="text-sm text-gray-600 mb-2">
          내용: <%= voiceItem.aiScript.userText || '분석 중...' %>
        </div>
        <div class="text-sm text-blue-600">
          분석: <%= voiceItem.aiScript.aiText || '분석 중...' %>
        </div>
      </div>
      <% }); %> <% } %>
    </div>
  </div>
</div>

<script>
  // 필터링 기능을 위한 JavaScript
  document.addEventListener("DOMContentLoaded", function () {
    const allItems = document.querySelectorAll("#history-list > div[data-id]");

    function filterItems(type) {
      allItems.forEach((item) => {
        if (
          type === "all" ||
          (type === "spelling" && item.querySelector(".bg-blue-100")) ||
          (type === "pronunciation" && item.querySelector(".bg-green-100"))
        ) {
          item.style.display = "block";
        } else {
          item.style.display = "none";
        }
      });

      // 버튼 스타일 업데이트
      document
        .querySelectorAll("#all-btn, #spelling-btn, #pronunciation-btn")
        .forEach((btn) => {
          btn.classList.remove("bg-blue-600", "text-white");
          btn.classList.add("bg-gray-200", "text-gray-700");
        });

      document
        .getElementById(`${type}-btn`)
        .classList.remove("bg-gray-200", "text-gray-700");
      document
        .getElementById(`${type}-btn`)
        .classList.add("bg-blue-600", "text-white");
    }

    // 버튼 이벤트 리스너
    document
      .getElementById("all-btn")
      .addEventListener("click", () => filterItems("all"));
    document
      .getElementById("spelling-btn")
      .addEventListener("click", () => filterItems("spelling"));
    document
      .getElementById("pronunciation-btn")
      .addEventListener("click", () => filterItems("pronunciation"));
  });
</script>
